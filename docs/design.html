<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Wii-Track</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<style type="text/css">

/*
*   math2html: convert LaTeX equations to HTML output.
*
*   Copyright (C) 2009,2010 Alex Fernández
*
*   Released under the terms of the `2-Clause BSD license'_, in short:
*   Copying and distribution of this file, with or without modification,
*   are permitted in any medium without royalty provided the copyright
*   notice and this notice are preserved.
*   This file is offered as-is, without any warranty.
*
* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause
*
*   Based on eLyXer: convert LyX source files to HTML output.
*   http://elyxer.nongnu.org/
*/
/* --end--
* CSS file for LaTeX formulas.
*/

/* Formulas */
.formula {
	text-align: center;
	font-family: "Droid Serif", "DejaVu Serif", "STIX", serif;
	margin: 1.2em 0;
}
span.formula {
	white-space: nowrap;
}
div.formula {
	padding: 0.5ex;
	margin-left: auto;
	margin-right: auto;
}

/* Basic features */
a.eqnumber {
	display: inline-block;
	float: right;
	clear: right;
	font-weight: bold;
}
span.unknown {
	color: #800000;
}
span.ignored, span.arraydef {
	display: none;
}
.formula i {
	letter-spacing: 0.1ex;
}

/* Alignment */
.align-left, .align-l {
	text-align: left;
}
.align-right, .align-r {
	text-align: right;
}
.align-center, .align-c {
	text-align: center;
}

/* Structures */
span.overline, span.bar {
	text-decoration: overline;
}
.fraction, .fullfraction {
	display: inline-block;
	vertical-align: middle;
	text-align: center;
}
.fraction .fraction {
	font-size: 80%;
	line-height: 100%;
}
span.numerator {
	display: block;
}
span.denominator {
	display: block;
	padding: 0ex;
	border-top: thin solid;
}
sup.numerator, sup.unit {
	font-size: 70%;
	vertical-align: 80%;
}
sub.denominator, sub.unit {
	font-size: 70%;
	vertical-align: -20%;
}
span.sqrt {
	display: inline-block;
	vertical-align: middle;
	padding: 0.1ex;
}
sup.root {
	font-size: 70%;
	position: relative;
	left: 1.4ex;
}
span.radical {
	display: inline-block;
	padding: 0ex;
	font-size: 150%;
	vertical-align: top;
}
span.root {
	display: inline-block;
	border-top: thin solid;
	padding: 0ex;
	vertical-align: middle;
}
span.symbol {
	line-height: 125%;
	font-size: 125%;
}
span.bigsymbol {
	line-height: 150%;
	font-size: 150%;
}
span.largesymbol {
	font-size: 175%;
}
span.hugesymbol {
	font-size: 200%;
}
span.scripts {
	display: inline-table;
	vertical-align: middle;
}
.script {
	display: table-row;
	text-align: left;
	line-height: 150%;
}
span.limits {
	display: inline-table;
	vertical-align: middle;
}
.limit {
	display: table-row;
	line-height: 99%;
}
sup.limit, sub.limit {
	line-height: 100%;
}
span.symbolover {
	display: inline-block;
	text-align: center;
	position: relative;
	float: right;
	right: 100%;
	bottom: 0.5em;
	width: 0px;
}
span.withsymbol {
	display: inline-block;
}
span.symbolunder {
	display: inline-block;
	text-align: center;
	position: relative;
	float: right;
	right: 80%;
	top: 0.3em;
	width: 0px;
}

/* Environments */
span.array, span.bracketcases, span.binomial, span.environment {
	display: inline-table;
	text-align: center;
	border-collapse: collapse;
	margin: 0em;
	vertical-align: middle;
}
span.arrayrow, span.binomrow {
	display: table-row;
	padding: 0ex;
	border: 0ex;
}
span.arraycell, span.bracket, span.case, span.binomcell, span.environmentcell {
	display: table-cell;
	padding: 0ex 0.2ex;
	line-height: 99%;
	border: 0ex;
}
/*
* CSS file for LaTeX formulas, extra stuff:
* binomials, vertical braces, stackrel, fonts and colors.
*/

/* Inline binomials */
span.binom {
	display: inline-block;
	vertical-align: middle;
	text-align: center;
	font-size: 80%;
}
span.binomstack {
	display: block;
	padding: 0em;
}

/* Over- and underbraces */
span.overbrace {
	border-top: 2pt solid;
}
span.underbrace {
	border-bottom: 2pt solid;
}

/* Stackrel */
span.stackrel {
	display: inline-block;
	text-align: center;
}
span.upstackrel {
	display: block;
	padding: 0em;
	font-size: 80%;
	line-height: 64%;
	position: relative;
	top: 0.15em;

}
span.downstackrel {
	display: block;
	vertical-align: bottom;
	padding: 0em;
}

/* Fonts */
span.mathsf, span.textsf {
	font-style: normal;
	font-family: sans-serif;
}
span.mathrm, span.textrm {
	font-style: normal;
	font-family: serif;
}
span.text, span.textnormal {
	font-style: normal;
}
span.textipa {
	color: #008080;
}
span.fraktur {
	font-family: "Lucida Blackletter", eufm10, blackletter;
}
span.blackboard {
	font-family: Blackboard, msbm10, serif;
}
span.scriptfont {
	font-family: "Monotype Corsiva", "Apple Chancery", "URW Chancery L", cursive;
	font-style: italic;
}

/* Colors */
span.colorbox {
	display: inline-block;
	padding: 5px;
}
span.fbox {
	display: inline-block;
	border: thin solid black;
	padding: 2px;
}
span.boxed, span.framebox {
	display: inline-block;
	border: thin solid black;
	padding: 5px;
}


</style>
</head>
<body>
<div class="document" id="wii-track">
<h1 class="title">Wii-Track</h1>

<p>In this document, we will a) give an overview of Wii-Track; b) describe its
overall system architecture and the reasons we chose the architecture; c)
describe our hackathon implementation; and d) discuss how this project could be
implemented at an industrial scale.</p>
<div class="section" id="overview">
<h1>Overview</h1>
<p>Wii-Track is a system for package tracking designed for use in a variety of
scenarios such as warehouses. The name Wii-Track comes from the fact that we
used a WiiFit board as our &quot;scale&quot; for this prototype.</p>
<p>Our overall goal was to make inventory tracking more cost-effective by utilizing
sensors and data analytics to identify inventory items automatically, without
human intervention. For the hackathon, we utilized two metrics (weight and
color) to identify objects, however, we designed the system to scale to any
number of additional metrics such as image recognition and infrared image data.</p>
</div>
<div class="section" id="architecture">
<h1>Architecture</h1>
<p>At a high level, the Wii-Track architecture has three components: edge nodes,
compute nodes, and a data store. User-facing applications can be built on top of
this framework (see <a class="reference internal" href="#hackathon-implementation">Hackathon Implementation</a> and <a class="reference internal" href="#industrial-scale-implementation">Industrial Scale
Implementation</a> below).</p>
<ol class="arabic simple">
<li><strong>Edge nodes:</strong> these nodes collect data about items, and send the raw data
to the compute nodes for processing.</li>
<li><strong>Compute nodes:</strong> these nodes process raw data using a variety of analytics.
In our case, these nodes were AWS Lambda functions.</li>
<li><strong>Data store:</strong> this stores information about the inventory and how it is
moving around. For our prototype, we utilized the AWS DynamoDB NoSQL database
to store information about the items we processed.</li>
</ol>
<p>There can be any number of edge nodes and compute nodes, and DynamoDB could be
replaced by any other datastore.</p>
<p>The overall data flow is as follows:</p>
<pre class="literal-block">
Edge nodes -&gt; Compute nodes -&gt; Data store -&gt; User facing applications
</pre>
<p>Here is a (non-comprehensive) list of considerations we discussed as we designed
our system architecture:</p>
<ul>
<li><p class="first"><strong>Edge nodes may not have much compute power.</strong> For our prototype, we used a
Raspberry Pi 1 which only has a 600 MHz ARM processor. Starting up simple
Python GUI applications can take over 30 seconds! However, compared to many
embedded devices, the Raspberry Pi has a large amount of compute power. Many
embedded devices don't have the ability to <tt class="docutils literal">malloc</tt> memory on the heap, so
simple operations like string manipulation are not feasible.</p>
<p>This led us to push all of the computation onto AWS Lambda. Edge nodes only
send raw data and we can then utilize the power of the Amazon infrastructure
for data processing.</p>
</li>
<li><p class="first"><strong>Edge nodes may be difficult to update.</strong> These embedded devices may be
installed in low-bandwidth areas and then possibly not replaced for years. If
we want to add new features, it would be difficult if computation were done at
the edge. By pushing all of the processing to Lambda, if we want to update how
the data is processed, it is very easy to update the Lambda function.</p>
<p>One tangible example of how this might be useful is that, in the future, we
may find a way to use the weight data over time as a metric for determining
the object using Machine Learning. If we only sent one data point to the
Lambda function, we would have to update the edge nodes to handle this
computationally-intensive ML. Whereas if all computation is done on Lambda,
this is a relatively easy addition to our Lambda function.</p>
<p>Additionally, to support a new type of edge node, all we need to do is create
a new Lambda function.</p>
</li>
<li><p class="first"><strong>Server administration is hard.</strong> AWS Lambda abstracts the server away, so we
are able to concentrate on code, not deployment. This was great for not only
the HackCU hackathon, but also for scalability in the long term.</p>
</li>
<li><p class="first"><strong>The data stored will not be uniform.</strong> If we have many different versions of
edge nodes, the data sent and stored may not be the same across versions. For
example, one version may send image data, while other nodes only have infrared
data. Additionally, the data is not highly relational; relations between data
are derived at an application layer. This variance in data that we need to
store led us to use AWS DynamoDB, a scalable, NoSQL database running on Amazon
infrastructure.</p>
</li>
<li><p class="first"><strong>
We wanted to, and did, win the <em>Best Use of AWS</em> challenge.
</strong> One of the prizes at HackCU was for the application that best utilized
Amazon AWS. We wanted to enter the competition for this prize, and that was
part of the reason we used AWS Lambda and AWS DynamoDB. Our entry into this
competition, won.</p>
</li>
</ul>
<!-- This is an ugly hack. I can't easily nest any role inside of a bold, so I'm
doing raw HTML instead... -->
<!-- TODO: Dish? -->
</div>
<div class="section" id="hackathon-implementation">
<h1>Hackathon Implementation</h1>
<p>At HackCU, we implemented a proof of concept for this project. We built a
prototype edge node, a prototype compute node, a prototype datastore, a client
to view the data in the datastore, and a client to control the edge node.</p>
<div class="section" id="edge-node">
<h2>Edge Node</h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the <a class="reference external" href="https://github.com/ColoradoSchoolOfMines/wii-track/tree/master/arduino"><tt class="docutils literal">arduino</tt></a> and <a class="reference external" href="https://github.com/ColoradoSchoolOfMines/wii-track/tree/master/rpi"><tt class="docutils literal">rpi</tt></a> directories and the <a class="reference external" href="https://github.com/ColoradoSchoolOfMines/wii-track/tree/master/wiiboard.py"><tt class="docutils literal">wiiboard.py</tt></a> file for the edge node source
code.</p>
</div>
<!-- TODO: Robby: fill these in. -->
<p>We implemented our edge node with two sensors: a scale (the WiiFit board) and a
camera (Raspberry Pi camera mounted on an Arduino-controled servo). The
Raspberry Pi was connected over TODO to the Arduino which controlled a servo
over TODO. This servo swivelled the camera around. The camera was connected
directly to the Raspberry Pi using TODO.</p>
<p>We built a client application in Qt using Python which controlled the servo, and
also showed a live image of the package. We also had the ability to take
pictures of the package. Our prototype required user interaction to take a
picture, but ideally, we would trigger this picture when the package is put on
the scale.</p>
<!-- TODO: Jack: fill in details of this here -->
<p>The WiiFit board was connected over Bluetooth to one of our computers. We would
have liked to make the Raspberry Pi communicate directly with the WiiFit board,
but this was infeasible since the Raspberry Pi does not have Bluetooth
capabilities. We used the <a class="reference external" href="urltotheoriginalsourcecode">TODO</a> library to communicate with the WiiFit. It
provided us with a constant stream of four data points: one weight measurement
for each of the four quadrants of the board. We sent this data directly to AWS
using the <a class="reference external" href="http://docs.python-requests.org/en/master/"><tt class="docutils literal">requests</tt></a> library.</p>
</div>
<div class="section" id="compute-node">
<h2>Compute Node</h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the <a class="reference external" href="https://github.com/ColoradoSchoolOfMines/wii-track/tree/master/color-lambda"><tt class="docutils literal"><span class="pre">color-lambda</span></tt></a> and <a class="reference external" href="https://github.com/ColoradoSchoolOfMines/wii-track/tree/master/weight-processing-lambda"><tt class="docutils literal"><span class="pre">weight-processing-lambda</span></tt></a> directories for the lambda function source code.</p>
</div>
<p>We created two Lambda functions to process the data from the edge node. If the
edge node were integrated into the single Raspberry Pi, we could have made it a
single Lambda function. However, because the edge node was implemented on two
different computers, we had to create two Lambda functions for our prototype.</p>
<div class="section" id="color-processing-lambda">
<h3>Color Processing Lambda</h3>
<p>The <tt class="docutils literal"><span class="pre">color-lambda</span></tt> function processed data from the camera. It used</p>
<!-- TODO describe libraries and method (whatever that crazy square rooting of
stuff was) -->
</div>
<div class="section" id="weight-processing-lambda">
<h3>Weight Processing Lambda</h3>
<p>The <tt class="docutils literal"><span class="pre">weight-processing-lambda</span></tt> took the weight data, and attempted to match it
to the weights already stored in a database table. The algorithm was as follows:</p>
<ol class="arabic">
<li><p class="first">Take all of the weight data that is being sent from the WiiFit and calculate
the average weight.</p>
</li>
<li><p class="first">We query a database pre-seeded with information about inventory items to get
all inventory items within 4kg of the measurement. (We could be much more
intelligent about this measurement, but for the hackathon, we just hardcoded
it.)</p>
</li>
<li><p class="first">For each of the items returned from the query, we calculated a confidence
that the item on the scale is indeed that object. We used a very simple
metric for this: the value of the PMF of a normal distribution centered
around the expected weight, <span class="formula"><i>x</i></span> from the database with a standard
deviation <span class="formula"><i>d</i></span> also stored in the database. The hight of a normal
distribution is not 1, so we had to multiply ba a factor (<span class="formula">1 ⁄ <i>k</i></span>) to
convert it to a percentage.</p>
<img alt="img/confidence-interval.png" src="img/confidence-interval.png" />
</li>
<li><p class="first">We store our confidences in each item in the DynamoDB database using the
<tt class="docutils literal">boto3</tt> library by Amazon for manipulating AWS objects.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="datastore">
<h2>Datastore</h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the <a class="reference external" href="https://github.com/ColoradoSchoolOfMines/wii-track/tree/master/dynamodb"><tt class="docutils literal">dynamodb</tt></a> directory has code related to creating the database schema,
and some test data that we used during development.</p>
</div>
<p>We used AWS DynamoDB as our datastore. We used this in two places: to store
manually-computed inventory weight information, and to store the results of our
predictions from the Lambda functions.</p>
</div>
</div>
<div class="section" id="industrial-scale-implementation">
<h1>Industrial Scale Implementation</h1>
<p>Our hackathon prototype cut a lot of corners, however we designed our project
with scalability in mind.</p>
</div>
</div>
</body>
</html>
